<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸€ ì‘ì„± - ì°½ì—…ì§€ì› í¬í„¸</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header admin-header">
        <div class="header-inner">
            <div class="logo">
                <a href="index.html">
                    <span class="logo-text">ì°½ì—…ì§€ì› í¬í„¸</span>
                </a>
                <span class="admin-badge">ê´€ë¦¬ì</span>
            </div>
            <nav class="main-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="index.html?category=support" class="nav-link">ì§€ì›ì‚¬ì—…/êµìœ¡</a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html?category=event" class="nav-link">í–‰ì‚¬/ì¶•ì œ</a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html?category=notice" class="nav-link">ê³µì§€ì‚¬í•­</a>
                    </li>
                </ul>
            </nav>
            <div class="header-utils">
                <span class="user-info" id="userInfo"></span>
                <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <div class="container">
            <div class="post-form-container">
                <div class="form-header">
                    <h1 id="formTitle">ìƒˆ ê¸€ ì‘ì„±</h1>
                    <a href="admin.html" class="btn-back">â† ëª©ë¡ìœ¼ë¡œ</a>
                </div>

                <form id="postForm" class="post-form">
                    <input type="hidden" id="postId" value="">

                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="form-section">
                        <h3 class="section-title">ê¸°ë³¸ ì •ë³´</h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="category">ì¹´í…Œê³ ë¦¬ <span class="required">*</span></label>
                                <select id="category" name="category" required>
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="support">ì§€ì›ì‚¬ì—…/êµìœ¡</option>
                                    <option value="event">í–‰ì‚¬/ì¶•ì œ</option>
                                    <option value="notice">ê³µì§€ì‚¬í•­</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="status">ìƒíƒœ <span class="required">*</span></label>
                                <select id="status" name="status" required>
                                    <option value="ongoing">ì§„í–‰ì¤‘</option>
                                    <option value="upcoming">ì ‘ìˆ˜ì˜ˆì •</option>
                                    <option value="closed">ë§ˆê°</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="title">ì œëª© <span class="required">*</span></label>
                            <input type="text" id="title" name="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                    </div>

                    <!-- ìƒì„¸ ì •ë³´ (ì§€ì›ì‚¬ì—…/êµìœ¡, í–‰ì‚¬/ì¶•ì œìš©) -->
                    <div class="form-section" id="detailSection">
                        <h3 class="section-title">ìƒì„¸ ì •ë³´</h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="organization">ì£¼ê´€ê¸°ê´€</label>
                                <input type="text" id="organization" name="organization" placeholder="ì£¼ê´€ê¸°ê´€ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                            <div class="form-group">
                                <label for="department">ì£¼ê´€ë¶€ì²˜</label>
                                <input type="text" id="department" name="department" placeholder="ì£¼ê´€ë¶€ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="region">ì§€ì—­</label>
                                <select id="region" name="region">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ì „êµ­">ì „êµ­</option>
                                    <option value="ì„œìš¸">ì„œìš¸</option>
                                    <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                                    <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                                    <option value="ì¸ì²œ">ì¸ì²œ</option>
                                    <option value="ê´‘ì£¼">ê´‘ì£¼</option>
                                    <option value="ëŒ€ì „">ëŒ€ì „</option>
                                    <option value="ìš¸ì‚°">ìš¸ì‚°</option>
                                    <option value="ì„¸ì¢…">ì„¸ì¢…</option>
                                    <option value="ê²½ê¸°">ê²½ê¸°</option>
                                    <option value="ê°•ì›">ê°•ì›</option>
                                    <option value="ì¶©ë¶">ì¶©ë¶</option>
                                    <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
                                    <option value="ì „ë¶">ì „ë¶</option>
                                    <option value="ì „ë‚¨">ì „ë‚¨</option>
                                    <option value="ê²½ë¶">ê²½ë¶</option>
                                    <option value="ê²½ë‚¨">ê²½ë‚¨</option>
                                    <option value="ì œì£¼">ì œì£¼</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="supportField">ì§€ì›ë¶„ì•¼</label>
                                <select id="supportField" name="supportField">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ì‚¬ì—…í™”">ì‚¬ì—…í™”</option>
                                    <option value="ê¸°ìˆ ê°œë°œ(R&D)">ê¸°ìˆ ê°œë°œ(R&D)</option>
                                    <option value="ì‹œì„¤Â·ê³µê°„Â·ë³´ìœ¡">ì‹œì„¤Â·ê³µê°„Â·ë³´ìœ¡</option>
                                    <option value="ë©˜í† ë§Â·ì»¨ì„¤íŒ…Â·êµìœ¡">ë©˜í† ë§Â·ì»¨ì„¤íŒ…Â·êµìœ¡</option>
                                    <option value="ê¸€ë¡œë²Œ">ê¸€ë¡œë²Œ</option>
                                    <option value="ì¸ë ¥">ì¸ë ¥</option>
                                    <option value="ìœµìÂ·ë³´ì¦">ìœµìÂ·ë³´ì¦</option>
                                    <option value="í–‰ì‚¬Â·ë„¤íŠ¸ì›Œí¬">í–‰ì‚¬Â·ë„¤íŠ¸ì›Œí¬</option>
                                    <option value="ì°½ì—…êµìœ¡">ì°½ì—…êµìœ¡</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="target">ëŒ€ìƒ</label>
                                <select id="target" name="target">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ì²­ì†Œë…„">ì²­ì†Œë…„</option>
                                    <option value="ëŒ€í•™ìƒ">ëŒ€í•™ìƒ</option>
                                    <option value="ì¼ë°˜ì¸">ì¼ë°˜ì¸</option>
                                    <option value="ëŒ€í•™">ëŒ€í•™</option>
                                    <option value="ì—°êµ¬ê¸°ê´€">ì—°êµ¬ê¸°ê´€</option>
                                    <option value="ì¼ë°˜ê¸°ì—…">ì¼ë°˜ê¸°ì—…</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="age">ì—°ë ¹ëŒ€</label>
                                <select id="age" name="age">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ë§Œ 20ì„¸ ë¯¸ë§Œ">ë§Œ 20ì„¸ ë¯¸ë§Œ</option>
                                    <option value="ë§Œ 20ì„¸ ~ 29ì„¸">ë§Œ 20ì„¸ ~ 29ì„¸</option>
                                    <option value="ë§Œ 30ì„¸ ~ 39ì„¸">ë§Œ 30ì„¸ ~ 39ì„¸</option>
                                    <option value="ë§Œ 40ì„¸ ì´ìƒ">ë§Œ 40ì„¸ ì´ìƒ</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="career">ì°½ì—…ì—…ë ¥</label>
                            <select id="career" name="career">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ì˜ˆë¹„ì°½ì—…ì">ì˜ˆë¹„ì°½ì—…ì</option>
                                <option value="1ë…„ ë¯¸ë§Œ">1ë…„ ë¯¸ë§Œ</option>
                                <option value="1ë…„ ~ 3ë…„ ë¯¸ë§Œ">1ë…„ ~ 3ë…„ ë¯¸ë§Œ</option>
                                <option value="3ë…„ ~ 5ë…„ ë¯¸ë§Œ">3ë…„ ~ 5ë…„ ë¯¸ë§Œ</option>
                                <option value="5ë…„ ~ 7ë…„ ë¯¸ë§Œ">5ë…„ ~ 7ë…„ ë¯¸ë§Œ</option>
                                <option value="7ë…„ ~ 10ë…„ ë¯¸ë§Œ">7ë…„ ~ 10ë…„ ë¯¸ë§Œ</option>
                                <option value="10ë…„ ì´ìƒ">10ë…„ ì´ìƒ</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="startDate">ì ‘ìˆ˜ ì‹œì‘ì¼</label>
                                <input type="date" id="startDate" name="startDate">
                            </div>
                            <div class="form-group">
                                <label for="endDate">ì ‘ìˆ˜ ë§ˆê°ì¼</label>
                                <input type="date" id="endDate" name="endDate">
                            </div>
                        </div>
                    </div>

                    <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
                    <div class="form-section">
                        <h3 class="section-title">ì´ë¯¸ì§€</h3>

                        <div class="image-upload-area">
                            <div class="upload-box" id="uploadBox">
                                <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
                                <div class="upload-placeholder">
                                    <span class="upload-icon">ğŸ“·</span>
                                    <p>í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                                    <p class="upload-hint">JPG, PNG, GIF (ìµœëŒ€ 5MB)</p>
                                </div>
                            </div>
                            <div class="image-preview" id="imagePreview">
                                <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>

                    <!-- ë‚´ìš© -->
                    <div class="form-section">
                        <h3 class="section-title">ë‚´ìš©</h3>

                        <div class="form-group">
                            <label for="summary">ìš”ì•½</label>
                            <textarea id="summary" name="summary" rows="3" placeholder="ê°„ë‹¨í•œ ìš”ì•½ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="content">ìƒì„¸ ë‚´ìš©</label>
                            <textarea id="content" name="content" rows="10" placeholder="ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="link">ê´€ë ¨ ë§í¬</label>
                            <input type="url" id="link" name="link" placeholder="https://example.com">
                        </div>
                    </div>

                    <!-- ë²„íŠ¼ -->
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="history.back()">ì·¨ì†Œ</button>
                        <button type="button" class="btn-secondary" onclick="saveTemp()">ì„ì‹œì €ì¥</button>
                        <button type="submit" class="btn-primary">ì €ì¥</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <div class="footer-inner">
            <div class="footer-info">
                <p class="copyright">Â© 2025 ì°½ì—…ì§€ì› í¬í„¸. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="data.js"></script>
    <script src="auth.js"></script>
    <script>
        let uploadedImage = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            const user = Auth.getCurrentUser();
            if (!user || !user.isAdmin) {
                alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('userInfo').textContent = user.userName + 'ë‹˜';

            // ìˆ˜ì • ëª¨ë“œì¸ì§€ í™•ì¸
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('id');
            if (postId) {
                loadPost(postId);
            }

            // ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ ìƒì„¸ì •ë³´ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
            document.getElementById('category').addEventListener('change', function() {
                const detailSection = document.getElementById('detailSection');
                if (this.value === 'notice') {
                    detailSection.style.display = 'none';
                } else {
                    detailSection.style.display = 'block';
                }
            });
        });

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            Auth.logout();
            window.location.href = 'index.html';
        }

        // ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° (ìˆ˜ì • ëª¨ë“œ)
        function loadPost(postId) {
            const post = DataManager.getPost(postId);
            if (!post) {
                alert('ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                window.location.href = 'admin.html';
                return;
            }

            document.getElementById('formTitle').textContent = 'ê¸€ ìˆ˜ì •';
            document.getElementById('postId').value = post.id;
            document.getElementById('category').value = post.category;
            document.getElementById('status').value = post.status;
            document.getElementById('title').value = post.title;
            document.getElementById('organization').value = post.organization || '';
            document.getElementById('department').value = post.department || '';
            document.getElementById('region').value = post.region || '';
            document.getElementById('supportField').value = post.supportField || '';
            document.getElementById('target').value = post.target || '';
            document.getElementById('age').value = post.age || '';
            document.getElementById('career').value = post.career || '';
            document.getElementById('startDate').value = post.startDate || '';
            document.getElementById('endDate').value = post.endDate || '';
            document.getElementById('summary').value = post.summary || '';
            document.getElementById('content').value = post.content || '';
            document.getElementById('link').value = post.link || '';

            if (post.image) {
                uploadedImage = post.image;
                showImagePreview(post.image);
            }
        }

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImage = e.target.result;
                showImagePreview(uploadedImage);
            };
            reader.readAsDataURL(file);
        }

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function showImagePreview(imageSrc) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = `
                <div class="preview-item">
                    <img src="${imageSrc}" alt="ë¯¸ë¦¬ë³´ê¸°">
                    <button type="button" class="btn-remove-image" onclick="removeImage()">Ã—</button>
                </div>
            `;
        }

        // ì´ë¯¸ì§€ ì œê±°
        function removeImage() {
            uploadedImage = null;
            document.getElementById('imageInput').value = '';
            document.getElementById('imagePreview').innerHTML = '';
        }

        // ì„ì‹œì €ì¥
        function saveTemp() {
            const formData = collectFormData();
            formData.isTemp = true;
            localStorage.setItem('tempPost', JSON.stringify(formData));
            alert('ì„ì‹œì €ì¥ ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // í¼ ë°ì´í„° ìˆ˜ì§‘
        function collectFormData() {
            return {
                id: document.getElementById('postId').value || null,
                category: document.getElementById('category').value,
                status: document.getElementById('status').value,
                title: document.getElementById('title').value,
                organization: document.getElementById('organization').value,
                department: document.getElementById('department').value,
                region: document.getElementById('region').value,
                supportField: document.getElementById('supportField').value,
                target: document.getElementById('target').value,
                age: document.getElementById('age').value,
                career: document.getElementById('career').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                summary: document.getElementById('summary').value,
                content: document.getElementById('content').value,
                link: document.getElementById('link').value,
                image: uploadedImage
            };
        }

        // í¼ ì œì¶œ
        document.getElementById('postForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = collectFormData();

            let result;
            if (formData.id) {
                result = DataManager.updatePost(formData.id, formData);
            } else {
                result = DataManager.addPost(formData);
            }

            if (result.success) {
                alert(result.message);
                window.location.href = 'admin.html';
            } else {
                alert(result.message);
            }
        });
    </script>
</body>
</html>
